#!/bin/bash
# AI Agent Task Workflow Command
# Usage: ./scripts/task [command]

set -e

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$PROJECT_ROOT"

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

case "$1" in
    "next")
        echo -e "${BLUE}üéØ Finding next task...${NC}"
        task-master next
        ;;
    
    "list")
        echo -e "${BLUE}üìã Current tasks:${NC}"
        task-master list --with-subtasks
        ;;
    
    "sync")
        echo -e "${BLUE}üîÑ Syncing AI agent context...${NC}"
        node scripts/ai-agent-sync.js
        ;;
    
    "workflow")
        echo -e "${BLUE}ü§ñ Intelligent workflow:${NC}"
        cat intelligent-workflow.md
        ;;
    
    "start")
        if [ -z "$2" ]; then
            echo -e "${RED}‚ùå Please provide a task ID${NC}"
            echo "Usage: ./scripts/task start TASK-001"
            exit 1
        fi
        echo -e "${GREEN}‚ñ∂Ô∏è  Starting task $2...${NC}"
        task-master set-status --id="$2" --status="in_progress"
        node scripts/ai-agent-sync.js
        ;;
    
    "complete")
        if [ -z "$2" ]; then
            echo -e "${RED}‚ùå Please provide a task ID${NC}"
            echo "Usage: ./scripts/task complete TASK-001"
            exit 1
        fi
        echo -e "${GREEN}‚úÖ Completing task $2...${NC}"
        task-master set-status --id="$2" --status="completed"
        node scripts/ai-agent-sync.js
        ;;
    
    "expand")
        if [ -z "$2" ]; then
            echo -e "${YELLOW}üîç Expanding all tasks...${NC}"
            task-master expand --all
        else
            echo -e "${YELLOW}üîç Expanding task $2...${NC}"
            task-master expand --id="$2" --num=5
        fi
        ;;
    
    "help"|"")
        echo -e "${BLUE}ü§ñ AI Agent Task Workflow${NC}"
        echo ""
        echo "Commands:"
        echo "  next       - Show the next task to work on"
        echo "  list       - List all tasks with status"
        echo "  sync       - Sync strategic context with tasks"
        echo "  workflow   - Show intelligent workflow recommendations"
        echo "  start ID   - Mark a task as in progress"
        echo "  complete ID - Mark a task as completed"
        echo "  expand [ID] - Expand task into subtasks (or all tasks)"
        echo "  help       - Show this help message"
        echo ""
        echo "Example:"
        echo "  ./scripts/task next"
        echo "  ./scripts/task start TASK-001"
        echo "  ./scripts/task complete TASK-001"
        ;;
    
    *)
        echo -e "${RED}‚ùå Unknown command: $1${NC}"
        echo "Run './scripts/task help' for usage"
        exit 1
        ;;
esac